<!DOCTYPE html>
{% load static %}

<html>
<head>

    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent the double scrollbar */
        }

        .header-container {
            position: sticky;
            top: 0;
            display: flex;
            height: 107px;
            align-items: center;
            justify-content: space-between;
            background-color: rgb(113, 147, 109);
            z-index: 100; /* Ensure it's above other elements */
            margin-bottom: -1px;
        }

        .heading {
            font-size: 32px;
            margin-left: 34px;
            margin-bottom: 5px;
        }




        .order-total {
            font-size: 24px;
            font-weight: bold;
            margin-right: 5px;
        }
        .order-total-tally {
            font-size: 24px;
            font-weight: bold;
            margin-right: 20px;
        }




        .count{
            font-size: 24px;
            font-weight: bold;
            margin-right: 5px;
        }
        .unique-items-count {
            font-size: 24px;
            font-weight: bold;
        }

        .slash{
            font-size: 24px;
            font-weight: bold;
        }
        .slots {
            font-size: 24px;
            font-weight: bold;
            margin-right: 20px;
        }

        .showAll-dropdown {
            font-size: 50px;
            font-weight: bold;
            margin-right: 20px;
            display: flex;
            height: 40px;
            border-radius: 7px;
            background-color:#fff;
        }

        .button-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-right: 20px;
        }

        .clear-button,
        .submit-button {
            width: 100px;
            height: 40px;
            font-size: 18px;
            padding: 10px 20px;
            color: black;
            font-weight: bold;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            text-decoration: none;
            background-color: rgb(198, 198, 190);
            transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effects */
            box-sizing: border-box;
        }

        .logout-button {
            width: 100px;
            height: 50px;
            display: inline-block; /* Display as an inline block */
            font-size: 18px;
            padding: 10px 20px;
            background-color: rgb(198, 198, 190);
            color: rgb(6, 6, 6);
            border: none;
            border-radius: 7px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effects */
        }

        .clear-button:hover,
        .submit-button:hover,
        .logout-button:hover {
            background-color: rgb(144, 145, 126);
            color: black;
        }

        .product-table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-container {
            max-height: calc(100vh - 107px);
            /*max-height: 100%;*/
            overflow-y: auto;
            position: relative;
        }


        .product-table td {
            padding: 10px;
            /*border-bottom: 1px solid #ddd;*/
            text-align: center;
        }

        .product-table th {
            position: sticky;
            top: 0;
            background-color: white;
            font-weight: bold;
            font-size: 20px;
            z-index: 1;
            height: 30px;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 10px;
        }

        .custom-select {
            font-size: 18px; /* Default font size for dropdown */
            font-weight: bold;
            text-align: center;
            font-family: Arial, sans-serif;
        }

        .custom-select option:checked {
            font-weight: bold;
            font-size: 18px; /* Adjust the font size as needed */
        }

        .product-table td {
            background-color: #dbdbdb;
            font-size: 18px;
            padding: 10px;
            border-bottom: 1px solid #070707;
        }

        .product-table .description {
            text-align: left !important;
        }

        .input-field {
            /*width: 10%;*/
            text-align: center;
        }

        .input-field input {
            font-weight: bold;
            width: 55px;
            height: 35px;
            text-align: center;
            font-size: 15px;
            font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande", "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
            border: 1px solid #000; /* Add a 1px solid black border */
            border-radius: 4px;
        }

        .filter-column {
            text-align: center;
        }

        /* CSS for the modal overlay for order for submission review */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
        }


        .submit-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            max-width: 80%;
            max-height: 80%;
            text-align: center;
            overflow-y: auto; /* Enable vertical scrolling */
        }

        /* CSS for the close button */
        .submit-modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        .error-message {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffcccc;
            padding: 10px 20px;
            border: 1px solid #ff0000;
            border-radius: 5px;
            color: #ff0000;
            z-index: 9999;
        }

        #error-text {
            margin: 0;
            font-weight: bold;
        }

        #close-error {
            background-color: #ff0000;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .table-row {
            border-bottom: 1px solid black;
            background-color: #e9e7e7;
            background-color: light #cfcece;
        }

        .previous-product-row {
            border-bottom: 1px solid black;
            background-color: lightyellow;
        }

        .filter-label{
            margin-bottom: 5px;
            display: block;
        }


        .heading-container {
            display: flex;
            align-items: center;
        }

        .wholesale-text {
            font-size: 24px;
            /*margin-top: 10px;*/
            margin-left: 34px; /* Add left margin to push it away from the left edge */
            margin-bottom: 20px;
            text-align: left;
        }

        .store-name {
            font-size: 32px; /* You can adjust the font size as needed */
            /*text-align: center; Center horizontally */
        }

        .store-heading {
            display: flex;
            flex-direction: column;
            align-items: left;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .table-row td{
            border-bottom: 1px solid #2c2b2b; /* Darker bottom border (adjust the color as needed) */
            background-color: #e6dd6a; /* Light gray background */
        }

        .table-row.ordered-item td {
            border-bottom: 1px solid #2c2b2b;
            background-color: lightgrey;
        }


        .modal-buttons {
            width: 50px;
            height: 25px;
            display: inline-block; /* Display as an inline block */
            font-size: 14px;
            /* padding: 10px 20px; */
            background-color: rgb(198, 198, 190);
            color: rgb(6, 6, 6);
            /* give it a border */
            border: none;
            border-radius: 7px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s; /* Smooth transition for hover effects */
            margin: 5px;
        }

        .modal-buttons:hover {
            background-color: rgb(144, 145, 126);
            color: black;
        }

        .modal-buttons-submit{
            width: 80px;
            height: 25px;
            display: inline-block; /* Display as an inline block */
            font-size: 14px;
            /* padding: 10px 20px; */
            background-color: rgb(198, 198, 190);
            color: rgb(6, 6, 6);
            border: none;
            border-radius: 7px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s; /* Smooth transition for hover effects */
            margin: 5px;
        }

        .modal-buttons-submit:hover {
            background-color: rgb(144, 145, 126);
            color: black;
        }

        .modal-buttons-submit-order{
            width: 80px;
            height: 25px;
            display: inline-block; /* Display as an inline block */
            font-size: 14px;
            /* padding: 10px 20px; */
            background-color: rgb(198, 198, 190);
            color: rgb(6, 6, 6);
            border: none;
            border-radius: 7px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s; /* Smooth transition for hover effects */
            margin: 5px;
        }

        .modal-buttons-submit-order:hover {
            background-color: rgb(144, 145, 126);
            color: black;
        }

        .modal-buttons-submit-order.loading {
            cursor: wait;
        }

        .modal-buttons-submit-order.loading::after {
            content: 'Submitting...';
            margin-left: 5px;
        }

    </style>

</head>

<body>
    <div class="header-container">
        <div class="store-heading">
            <h1 class="heading">Uprising Seeds</h1>
            <span class="wholesale-text">Wholesale Order Form</span>
        </div>
        <h1 class="store-name">{{ store.name }}</h1>
        <div class="button-container">

            <span class="order-total">$ </span>
            <span class="order-total-tally"><span id="order-total-tally">0.00</span></span>

            <span class="count">Variety Count: </span>
            <span class="unique-items-count"><span id="unique-items-count">0</span></span>
            <span class="slash">/</span>
            <span class="slots">{{ slots }}</span>

            <div class="showAll-dropdown">
                <select id="showAll-dropdown" class="showAllfilter-dropdown custom-select" size="1">
                    <option value="">All Items</option>
                    <option value="newItems">New</option>
                    <option value="prevItems">Previously Ordered</option>
                </select>
            </div>

            <button class="clear-button" onclick=showVerifyClearOrderModal()>Clear</button>
            <button class="submit-button" onclick=displayModal()>Submit</button>
            <button class="logout-button" id="logout-button">Logout</button>
        </div>
    </div>

    <form id="order-form" method="POST">
        {% csrf_token %}
        <div class="table-container">
            <table class="product-table", id="product-table">
                <tr>
                    <th class="input-field">Qty</th>
                    <th>Notes</th>
                    <th class="filter-column">
                        <!-- Category -->
                        <div class="filter-dropdown" style="margin-bottom: 1px;">
                            <label for="category-filter" class="filter-label">Filter:</label>

                            <select id="category-filter" class="filter-dropdown custom-select" size="1">
                                <option value="">All</option>
                                <option value="vegetables">Vegetables</option>
                                <option value="herbs">Herbs</option>
                                <option value="flowers">Flowers</option>
                            </select>

                        </div>
                    </th>
                    <th>Type</th>
                    <th>Sub Type</th>
                    <th>Variety</th>
                    <th class="description">Description</th>
                    <th class="photo">Photo</th>
                </tr>

            {% for product in products %}

                <tr id="product-row-{{ product.item_number }}" class="table-row">

                    <td class="input-field"><input type="number" name="quantity" min="0", step="5" value="0" item-number="{{ product.item_number }}" variety="{{ product.variety }}" veg-type="{{ product.veg_type }}" tabindex="{{ forloop.counter }}"></td>
                    <td>{{ product.notes }}</td>
                    <td>{{ product.category }}</td>
                    <td>{{ product.veg_type }}</td>
                    <td>{{ product.sub_type }}</td>
                    <td>{{ product.variety }}</td>
                    <td class="description">{{ product.description }}</td>

                    <td>
                        <a href="#" data-photolink="{% static product.photo %}" onclick="navigateToPhoto(event)">
                            View Photo
                        </a>
                    </td>
                </tr>
            {% endfor %}
            </table>
        </div>

    </form>

    <div class="modal-overlay" id="modalOverlay">
        <div class="submit-modal-content">
            <span class="submit-modal-close" onclick="closeModal()">&times;</span>
            <!-- a new div for displaying ordered products -->
            <div id="orderedProducts"></div>
            <p>Order Total: $<span id="orderTotal"></span></p>
            <p>Click "Submit" to submit for processing or "Cancel" to go back and make changes to your order.</p>
            <p>Enable pop-ups to allow order confirmation page to open once order is submitted.</p>
            <button id="modalSubmitButton" type="button" class="modal-buttons-submit-order">Submit</button>
            <button id="modalCloseButton" type="button" class="modal-buttons-submit" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <!--<div class="modal-overlay" id="modalOverlay">-->
    <!--    <div class="submit-modal-content">-->
    <!--        <span class="submit-modal-close" onclick="closeModal()">&times;</span>-->
            <!-- a new div for displaying ordered products -->
    <!--        <div id="orderedProducts"></div>-->
    <!--        <p>Order Total: $<span id="orderTotal"></span></p>-->
    <!--        <p>If submitted, your invoice will be mailed separately with your order.</p>-->
    <!--        <button id="modalSubmitButton" type="button" class="modal-buttons-submit-order">Submit</button>-->
    <!--        <button id="modalCloseButton" type="button" class="modal-buttons-submit" onclick="closeModal()">Cancel</button>-->
    <!--    </div>-->
    <!--</div>-->

    <!-- Modal for order submission success message -->
    <div class="modal-overlay" id="successModalOverlay">
        <div class="submit-modal-content">
            <span class="submit-modal-close" onclick="closeModal()">&times;</span>
            <h2>Order Submitted Successfully!</h2>
            <p>We will notify you when your order ships.</p>
        </div>
    </div>

    <!-- Modal for clear order verification -->
    <div class="modal-overlay" id="verifyClearOrder">
        <div class="submit-modal-content">
            <span class="submit-modal-close" onclick="closeModal()">&times;</span>
            <h2>Clear Order</h2>
            <p>Are you sure you want to clear your order?</p>
            <button id="submitClearOrder" type="button" class="modal-buttons">Yes</button>
            <button id="clearOrderCloseButton" type="button" class="modal-buttons" onclick="closeModal()">No</button>
        </div>
    </div>

    <!-- Modal for confirming logout -->
    <div class="modal-overlay" id="verifyLogout">
        <div class="submit-modal-content">
            <span class="submit-modal-close" onclick="closeModal()">&times;</span>
            <h2>Logout</h2>
            <p> Are you sure? Any order data that <br> has not been submitted will be lost. </p>
            <button id="submitLogout" type="button" class="modal-buttons">Yes</button>
            <button id="logoutCloseButton" type="button" class="modal-buttons" onclick="closeModal()">No</button>
        </div>
    </div>

    <div class="error-message">
        <p id="error-text">Error message goes here</p>
        <button id="close-error">Close</button>
    </div>

    <script>

        var orderData = {};
        var pktPrice = 2.40;

        var product_dict = {101: ['Calypso', 'BEAN'], 102: ['Cocaigne', 'BEAN'], 103: ['Flageolet Vert', 'BEAN'], 104: ['Hungarian Rice Bean', 'BEAN'], 105: ['Hutterite', 'BEAN'], 106: ['Ireland Creek Annie', 'BEAN'],
                            107: ['Jacob’s Cattle', 'BEAN'], 108: ['Jacob’s Gold', 'BEAN'], 109: ['Kenearly Yellow Eye', 'BEAN'], 110: ['Lina Sisco’s Bird Egg', 'BEAN'], 111: ['Marfax', 'BEAN'], 112: ['Purgatorio', 'BEAN'],
                            113: ['Rockwell', 'BEAN'], 114: ['Rosso di Lucca', 'BEAN'], 115: ['Tiger’s Eye', 'BEAN'], 116: ['Zolfino', 'BEAN'], 117: ['Alaric (Tarbais)', 'BEAN'], 118: ['Annie Jackson', 'BEAN'],
                            119: ['Pellegrini', 'BEAN'], 120: ['Sorana', 'BEAN'], 121: ['Tolosa', 'BEAN'], 122: ['Karmazyn', 'BEAN'], 123: ['Blooming Prairie', 'BEAN'], 124: ['Dragon Langerie', 'BEAN'], 125: ['Empress', 'BEAN'],
                            126: ['Provider', 'BEAN'], 127: ['Marvel of Venice', 'BEAN'], 128: ['Trionfo Violetto', 'BEAN'], 129: ['Touchstone', 'BEET'], 130: ['Crapaudine', 'BEET'], 131: ['Feuer Kugel', 'BEET'],
                            132: ['Lutz Green Leaf', 'BEET'], 133: ['Shiraz', 'BEET'], 134: ['Chioggia', 'BEET'], 385: ['3 Beet Mix', 'BEET'], 135: ['Novantina', 'BROCCOLI'], 136: ['Solstice', 'BROCCOLI'],
                            137: ['Umpqua', 'BROCCOLI'], 138: ['Takinogawa', 'BURDOCK'], 139: ['Dowinda', 'CABBAGE'], 140: ['Filderkraut', 'CABBAGE'], 141: ['January King', 'CABBAGE'], 142: ['Columbia', 'CABBAGE'],
                            143: ['Marner', 'CABBAGE'], 144: ['Gobbo di Nizza', 'CARDOON'], 145: ['Rainbow Carrot Mix', 'CARROT'], 146: ['Dragon', 'CARROT'], 147: ['Scarlet Nantes', 'CARROT'], 148: ['Tonda di Parigi', 'CARROT'],
                            149: ['Prestige', 'CAULIFLOWER'], 150: ['Monarch', 'CELERIAC'], 151: ['Rainbow Chard', 'CHARD'], 152: ['Cascade Glaze', 'COLLARDS'], 153: ['Champion', 'COLLARDS'], 154: ['Floriani Red Flint', 'CORN'],
                            155: ['Painted Mountain', 'CORN'], 156: ['Amish Butter', 'CORN'], 157: ['Dakota Black', 'CORN'], 158: ['Tuxana', 'CORN'], 159: ['Vorgebirgstrauben', 'CUCUMBER'], 160: ['Çengelköy', 'CUCUMBER'],
                            161: ['Lemon', 'CUCUMBER'], 162: ['Sandita', 'CUCUMBER'], 163: ['Shintokiwa', 'CUCUMBER'], 164: ['Silver Slicer', 'CUCUMBER'], 165: ['Sweet Marketmore', 'CUCUMBER'], 166: ['Diamond', 'EGGPLANT'],
                            378: ['Violetta di Firenze', 'EGGPLANT'], 167: ['Finale', 'FENNEL'], 168: ['Suriname', 'GREENS'], 169: ['Astro', 'GREENS'], 170: ['Rucola', 'GREENS'], 383: ['Wasabi Arugula', 'GREENS'],
                            171: ['Early Mizuna', 'GREENS'], 172: ['Golden Frills', 'GREENS'], 173: ['Ruby Streaks', 'GREENS'], 174: ['Tatsoi', 'GREENS'], 175: ['Uprising Braising Mix', 'GREENS'],
                            176: ['Wrinkled Crinkled Crumpled', 'GREENS'], 178: ['Uprising Mild Mix', 'GREENS'], 179: ['Uprising Spicy Mix', 'GREENS'], 180: ['Green Wave', 'GREENS'], 177: ['Broadleaf', 'GREENS'],
                            181: ['Blood Sorrel', 'GREENS'], 182: ['Erba Stella (Minutina)', 'GREENS'], 183: ['A Tale of Three Kales', 'KALE'], 184: ['Black Tuscan', 'KALE'], 185: ['Dazzling Blue', 'KALE'],
                            186: ['Dwarf Blue Scotch', 'KALE'], 187: ['Red Russian', 'KALE'], 188: ['Russian Frills', 'KALE'], 189: ['Lincoln', 'LEEK'], 190: ['Neptune', 'LEEK'], 191: ['Winter Density', 'LETTUCE'],
                            192: ['Divina', 'LETTUCE'], 193: ['Scarlet Butter', 'LETTUCE'], 194: ['Tennis Ball', 'LETTUCE'], 195: ['Emerald Fan', 'LETTUCE'], 196: ['Hyper Red Rumpled Waved', 'LETTUCE'],
                            197: ['La Brillante', 'LETTUCE'], 198: ['Merlot', 'LETTUCE'], 199: ['Royal Red', 'LETTUCE'], 200: ['Bijella', 'LETTUCE'], 201: ['Flashy Butter Oak', 'LETTUCE'], 202: ['Italienischer', 'LETTUCE'],
                            203: ['Mascara', 'LETTUCE'], 204: ['Barnwood Gem', 'LETTUCE'], 205: ['Cimarron', 'LETTUCE'], 206: ['Eruption', 'LETTUCE'], 207: ['Flashy Trout’s Back', 'LETTUCE'], 208: ['Jericho', 'LETTUCE'],
                            375: ['Little Gem', 'LETTUCE'], 209: ['Uprising Lettuce Mix', 'LETTUCE'], 210: ['Blacktail Mountain', 'MELON'], 211: ['Janosik', 'MELON'], 212: ['Eel River', 'MELON'],
                            213: ['Giallo D’Inverno', 'MELON'], 214: ['Prescott Fond Blanc', 'MELON'], 215: ['Sakata Sweet', 'MELON'], 216: ['Ishikura Long Winter', 'ONION'], 217: ["Ed's Red", 'ONION'],
                            376: ['Rijnsburg 5', 'ONION'], 218: ['Rossa di Milano', 'ONION'], 219: ['Ailsa Craig', 'ONION'], 220: ['Red Long of Tropea', 'ONION'], 221: ['Lancer', 'PARSNIP'], 222: ['Roveja', 'PEA'],
                            223: ['Maestro', 'PEA'], 224: ['Cascadia', 'PEA'], 225: ['Sugar Snap', 'PEA'], 226: ['Sugar Ann', 'PEA'], 227: ['Golden Sweet', 'PEA'], 228: ['Ho Lan Dow', 'PEA'], 229: ['Schweizer Riesen', 'PEA'],
                            230: ['Basque', 'PEPPER'], 231: ['Pimiento di Padron', 'PEPPER'], 232: ['Sarit Gat', 'PEPPER'], 377: ['Biquinho Red', 'PEPPER'], 233: ['Elephant Ears', 'PEPPER'], 234: ['Jimmy Nardello', 'PEPPER'],
                            235: ['Marta Polka', 'PEPPER'], 236: ['Petit Marseillais', 'PEPPER'], 237: ['Long Pie', 'PUMPKIN'], 238: ['Winter Luxury', 'PUMPKIN'], 239: ['French Breakfast', 'RADISH'], 240: ['Sora', 'RADISH'],
                            241: ['Beaujolais', 'SPINACH'], 242: ['Winter Bloomsdale', 'SPINACH'], 243: ['Winter Giant', 'SPINACH'], 244: ['Odesa', 'SQUASH'], 245: ['Yellow Crookneck', 'SQUASH'],
                            246: ['Costata Romanesco', 'SQUASH'], 247: ['Dark Star', 'SQUASH'], 248: ['Bitterroot Buttercup', 'SQUASH'], 249: ['Black Forest Kabocha', 'SQUASH'], 250: ['Black Futsu', 'SQUASH'],
                            251: ['Burpee’s Butterbush', 'SQUASH'], 252: ['Sweet Meat', 'SQUASH'], 253: ['Zeppelin Delicata', 'SQUASH'], 379: ['Zucca Mantovana', 'SQUASH'], 254: ['De Milpa', 'TOMATILLO'],
                            255: ['Black Cherry', 'TOMATO'], 256: ['Blush', 'TOMATO'], 257: ['Pinky', 'TOMATO'], 258: ['Sweet Orange II', 'TOMATO'], 259: ['Afghan', 'TOMATO'], 260: ['Jaune Flamme', 'TOMATO'],
                            261: ['Latah', 'TOMATO'], 262: ['Matina', 'TOMATO'], 263: ['Stupice', 'TOMATO'], 264: ['Black Prince', 'TOMATO'], 265: ['Nepal', 'TOMATO'], 266: ['Cuor di Bue Albenga', 'TOMATO'],
                            283: ['Anise Hyssop', 'ANISE HYSSOP'], 267: ['Italian Large Leaf', 'BASIL'], 382: ['German Chamomile', 'CHAMOMILE'], 268: ['Pokey Joe', 'CILANTRO'], 269: ['Goldkrone', 'DILL'],
                            303: ['Echinacea purpurea', 'ECHINACEA'], 270: ['Hyssop', 'HYSSOP'], 321: ['Mexican Tarragon', 'MARIGOLD'], 271: ['Mentuccia Romana', 'NEPITELLA'], 272: ['Mersin', 'PARSLEY'],
                            273: ['Sculpit (Stridolo)', 'SCULPIT'], 274: ['Blue Fenugreek', 'TRIGONELLA'], 275: ['Tulsi (Sacred Basil)', 'TULSI'], 276: ['Common Mullein', 'VERBASCUM'], 278: ['Coral Fountains', 'AMARANTH'],
                            279: ['Elephant Head', 'AMARANTH'], 280: ['Hot Biscuits', 'AMARANTH'], 281: ['Love Lies Bleeding', 'AMARANTH'], 282: ['Opopeo', 'AMARANTH'], 284: ['Hot Pants', 'ASTER'],
                            285: ['Tower Chamois', 'ASTER'], 380: ['Tower Silver', 'ASTER'], 286: ['Black Ball', 'BACHELOR’S BUTTON'], 287: ['Florist Blue Boy', 'BACHELOR’S BUTTON'], 288: ['Aloha Blanca', 'BASKET FLOWER'],
                            289: ['Borage', 'BORAGE'], 291: ['Calendula Mix', 'CALENDULA'], 290: ['Zeolights', 'CALENDULA'], 292: ['Ruby Parfait', 'CELOSIA'], 293: ['Supercrest and Friends', 'CELOSIA'],
                            294: ['Pride of Gibraltar', 'CERINTHE'], 295: ['Violet Queen', 'CLEOME'], 296: ['Black Barlow', 'COLUMBINE'], 297: ['Bordeaux Barlow', 'COLUMBINE'], 298: ['Roulette', 'COREOPSIS'],
                            299: ['Diablo', 'COSMOS'], 300: ['Snow Puff', 'COSMOS'], 301: ['Velouette', 'COSMOS'], 302: ['Xsenia', 'COSMOS'], 381: ['Pink Butterfly', 'DELPHINIUM'], 386: ['Blue Lace Flower', 'DIDISCUS'],
                            304: ['Edible Flower Mix', 'EDIBLE'], 305: ['Blue Glitter', 'ERYNGIUM'], 306: ['Full Moon', 'FOUR O’CLOCK'], 307: ['Strega', 'FOUR O’CLOCK'], 308: ['Apricot Beauty', 'FOXGLOVE'],
                            309: ['Café Creme', 'FOXGLOVE'], 310: ['Giant Yellow Herold', 'FOXGLOVE'], 311: ['Wild Cascades', 'FOXGLOVE'], 312: ['Frosted Explosion', 'GRASS'], 313: ['Covent Garden', 'GYPSOPHILA'],
                            314: ['Blue Pearl', "JACOB'S LADDER"], 315: ['Blue Cloud', 'LARKSPUR'], 316: ['Earl Grey', 'LARKSPUR'], 317: ['Salmon Beauty', 'LARKSPUR'], 318: ['White Cloud', 'LARKSPUR'],
                            319: ['French Brocade', 'MARIGOLD'], 320: ['Gems', 'MARIGOLD'], 322: ['Pinwheel', 'MARIGOLD'], 323: ['Lemon Bergamot', 'MONARDA'], 324: ['Grandpa Ott’s', 'MORNING GLORY'],
                            325: ['Trailing Mix', 'NASTURTIUM'], 326: ['Alaska', 'NASTURTIUM'], 327: ['Langsdorff’s Tobacco', 'NICOTIANA'], 328: ['Lime Green', 'NICOTIANA'], 329: ['Only The Lonely', 'NICOTIANA'],
                            330: ['Peach Screamer', 'NICOTIANA'], 331: ['Bridal Veil', 'NIGELLA'], 332: ['Delft Blue', 'NIGELLA'], 333: ['Exotica', 'NIGELLA'], 334: ["Bee's Friend", 'PHACELIA'],
                            335: ['California Poppy Mix', 'POPPY'], 336: ['Pastel Meadows', 'POPPY'], 337: ['Amazing Grey', 'POPPY'], 338: ['Cornfield', 'POPPY'], 339: ['Mother of Pearl', 'POPPY'], 340: ['Pandora', 'POPPY'],
                            341: ['Black Swan', 'POPPY'], 342: ['Danish Flag', 'POPPY'], 343: ['Flemish Antique', 'POPPY'], 344: ['Frilled White', 'POPPY'], 345: ['Ziar Breadseed', 'POPPY'], 346: ['Autumn Sunset', 'RUDBECKIA'],
                            347: ['Prairie Glow', 'RUDBECKIA'], 348: ['Prairie Sun', 'RUDBECKIA'], 349: ['Sahara', 'RUDBECKIA'], 350: ['Texas Hummingbird Sage', 'SALVIA'], 351: ['Transylvanian Sage', 'SALVIA'],
                            352: ['White Swan', 'SALVIA'], 353: ['White Beauty', 'SAPONARIA'], 354: ['Fama Deep Blue', 'SCABIOSA'], 355: ['Fata Morgana', 'SCABIOSA'], 356: ['Giant Yellow', 'SCABIOSA'],
                            357: ['Salmon Queen', 'SCABIOSA'], 358: ['Snowmaiden', 'SCABIOSA'], 359: ['Apricot Peach Mix', 'STRAWFLOWER'], 360: ['Monstrosum Fireball', 'STRAWFLOWER'], 361: ['Garden Anarchy', 'SUNFLOWER'],
                            362: ['Giant Sungold', 'SUNFLOWER'], 363: ['Reds', 'SUNFLOWER'], 364: ['Soraya', 'SUNFLOWER'], 365: ['Tarahumara', 'SUNFLOWER'], 366: ['Transylvanian Giant', 'SUNFLOWER'],
                            367: ['April in Paris', 'SWEET PEA'], 384: ['Azureus', 'SWEET PEA'], 387: ['Lathyrus Chloranthus', 'SWEET PEA'], 368: ['Arctic Summer', 'VERBASCUM'], 369: ['Phoenician Mullein', 'VERBASCUM'],
                            370: ['Benary’s Giant Mix', 'ZINNIA'], 371: ['Queen Red Lime', 'ZINNIA'], 372: ['Salmon Rose', 'ZINNIA'], 373: ['Zinderella Lilac', 'ZINNIA'], 374: ['Zinderella Peach', 'ZINNIA'],
                            388: ['Borlotto Gaston', 'BEAN'], 389: ["Aunt Molly's", 'GROUNDCHERRY'], 390: ['Goldrush', 'LETTUCE'], 391: ['Prize Choi', 'GREENS'], 393: ['Ҫekirdeği Oyali', 'MELON'],
                            394: ['Yellow Nardello', 'PEPPER'], 395: ['Double Diamond', 'YARROW'], 396: ['Love Parade', 'YARROW'], 397: ['Green Gold', 'BUPLEURUM'], 398: ['Silvery Rose', 'STRAWFLOWER'],
                            400: ['Speckled', 'LETTUCE'], 401: ["Grandpa Admire's", 'LETTUCE'], 402: ['Australian Yellowleaf', 'LETTUCE'], 403: ['Cracoviensis', 'LETTUCE'], 404: ['Les Orielles du Diable', 'LETTUCE'],
                            405: ['Reine de Glaces', 'LETTUCE'], 406: ['Howden', 'PUMPKIN'], 407: ['Koralik', 'TOMATO'], 408: ['Galina', 'TOMATO'], 409: ['Gold Rush', 'BEAN'], 410: ['Yellowstone', 'CARROT'],
                            411: ["Gardener's Sweetheart", 'TOMATO'], 412: ['Carbon', 'TOMATO'], 413: ['Fairy Trumpets', 'FOUR O’CLOCK'], 414: ['Bronze Queen', 'NICOTIANA'], 415: ['Kingfisher', 'SWEET PEA'],
                            416: ['Mollie Rilstone', 'SWEET PEA'], 417: ['Windsor', 'SWEET PEA'], 392: ['Matsushima', 'CABBAGE'], 418: ['Vertissimo', 'CHERVIL'], 399: ['Torch', 'SUNFLOWER'], 419: ['Flora Norton', 'SWEET PEA'],
                            420: ['Bristol', 'Sweet Pea'], 421: ['Suzy Z', 'Sweet Pea'], 422: ['Just Jenny', 'Sweet Pea'], 423: ['Mystery Rose', 'FORGET-ME-NOT'], 424: ['Coral', 'CARROT'], 441: ['Merveille des Quatre Saisons', 'LETTUCE'],
                            442: ['Stocky Red Roaster', 'PEPPER'], 433: ['Manyel', 'TOMATO'], 432: ['Moldovan Green', 'TOMATO'], 434: ['Northern Ruby', 'TOMATO'], 435: ['Red Fig', 'TOMATO'], 440: ['Lilac Pompom', 'POPPY']};



        // Function to update the unique item count
        function updateUniqueItemCount() {
            //console.log('inside updateUniqueItemCount function');
            const inputFields = document.querySelectorAll('.input-field input');
            let uniqueItemCount = 0;
            let totalItemCount = 0;
            let totalPrice = 0.00;

            inputFields.forEach((input) => {
                const quantity = parseInt(input.value);
                if (!isNaN(quantity) && quantity > 0) {
                    uniqueItemCount++;
                }

            if (!isNaN(quantity)) {
                totalItemCount += quantity; // Sum up all input field values
            }

            });

            totalPrice = (totalItemCount * pktPrice).toFixed(2);

            // Display the count in the HTML
            document.getElementById('unique-items-count').textContent = uniqueItemCount;
            document.getElementById('order-total-tally').textContent = totalPrice;
        }

        function showVerifyClearOrderModal() {
            //console.log('inside showVerifyClearOrderModal function');
            // Show the modal
            var modal = document.getElementById('verifyClearOrder');
            modal.style.display = 'block';

            // Add an event listener to the "Submit" button inside the modal
            var clearOrderSubmit= document.getElementById('submitClearOrder');
            clearOrderSubmit.addEventListener('click', clearOrder);

        }

        function showLogoutVerification() {
            //console.log('inside showLogoutVerification function');
            // Show the modal
            var modal = document.getElementById('verifyLogout');
            modal.style.display = 'block';

            // Add an event listener to the "Submit" button inside the modal
            var logoutSubmit= document.getElementById('submitLogout');
            logoutSubmit.addEventListener('click', logout);

        }

        function handleSubmitButtonClick() {
            submitOrder(orderData);
        }


        function handleOrderSuccess(submittedData) {
            // Close the modal
            closeModal();
            // console.log("-------------------------- Submitted Data ----------------------------");
            // console.log(submittedData)


            // call the pdf function
            generateOrderPDF(submittedData);

            // Clear the order
            clearOrder();

            // Show the success modal
            var successModal = document.getElementById('successModalOverlay');
            successModal.style.display = 'block';

            // Remove the event listener to prevent it from firing again
            var submitButtonModal = document.getElementById('modalSubmitButton');
            submitButtonModal.removeEventListener('click', handleSubmitButtonClick);

        }


        function displayModal() {
            //gather order data and calculate order total
            var table = document.getElementById('product-table');
            var rows = table.getElementsByTagName('tr');
            var orderVars = [];
            for (var i = 1; i < rows.length; i++) {  // Start from index 1 to skip the header row
                var row = rows[i];
                var itemNumber = row.querySelector('input').getAttribute('item-number');
                var variety = row.querySelector('input').getAttribute('variety');
                var quantity = parseInt(row.querySelector('input').value);
                var vegType = row.querySelector('input').getAttribute('veg-type');

                if (quantity > 0) {
                    // console.log(itemNumber, quantity);
                    orderData[itemNumber] = quantity;
                    orderVars.push({ variety, quantity, vegType });

                }
            }

            // Calculate the order total
            var total = 0;
            for (var itemNumber in orderData) {
                total += orderData[itemNumber];
            }
            var orderTotal = total * pktPrice;

            // Display the order total in the modal
            document.getElementById('orderTotal').textContent = orderTotal.toFixed(2);

            // Show the modal
            var modal = document.getElementById('modalOverlay');
            modal.style.display = 'block';

            // Add an event listener to the "Submit" button inside the modal
            var submitButtonModal = document.getElementById('modalSubmitButton');
            submitButtonModal.addEventListener('click', handleSubmitButtonClick);

            // Get the container for ordered products
            var orderedProductsContainer = document.getElementById('orderedProducts');
            // Clear previous content
            orderedProductsContainer.innerHTML = '';

            // Loop through orderVars to create a list of ordered products
            for (var i = 0; i < orderVars.length; i++) {
                var orderVar = orderVars[i];
                var quantity = orderVar.quantity;

                // Create a div to display product information
                var productDiv = document.createElement('div');
                productDiv.textContent = `${quantity} x ${orderVar.variety} (${orderVar.vegType})`;
                orderedProductsContainer.appendChild(productDiv);
            }
        }


        // Colors the previously ordered items a different color
        function checkPreviousItems() {
            console.log('Inside checkPreviousItems function');
            var previousItems = {{ previous_items|safe }};
            var tableRows = document.querySelectorAll('.table-row');

            tableRows.forEach(function(row) {
                var itemNumberElement = row.querySelector('.input-field input[name="quantity"]');
                if (itemNumberElement) {
                    var itemNumber = itemNumberElement.getAttribute('item-number');
                    // console.log(itemNumber);
                    if (previousItems.includes(itemNumber.toString())) {
                        // console.log('Item number found: ', itemNumber);
                        row.classList.add('ordered-item');
                    }
                }
            });
        }


        function closeModal() {
            //console.log('inside closeModal function');
            var modal = document.getElementById('modalOverlay');
            modal.style.display = 'none';
            orderData = {};
            var modal = document.getElementById('successModalOverlay');
            modal.style.display = 'none';
            var modal = document.getElementById('verifyClearOrder');
            modal.style.display = 'none';
            var modal = document.getElementById('verifyLogout');
            modal.style.display = 'none';
        }


        function submitOrder(submittedData) {

            // Disable the submit button
            var submitButtonModal = document.getElementById('modalSubmitButton');
            submitButtonModal.classList.add('loading');
            submitButtonModal.disabled = true;

            var storeName = '{{ store.username }}';
            var url = '/accounts/' + storeName + '/';

            var xhr = new XMLHttpRequest();
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));


            xhr.onload = function () {

                document.getElementById('modalSubmitButton').disabled = false;
                document.getElementById('modalSubmitButton').classList.remove('loading');

                console.log(xhr.status)
                if (xhr.status === 200) {
                    // Order submitted successfully
                    handleOrderSuccess(submittedData);

                } else if (xhr.status === 400) {
                    console.log("inside 400")
                    var responseJson = JSON.parse(xhr.responseText);
                    console.log(responseJson)
                    if (responseJson.invalid_products) {
                        // Update the frontend table by removing invalid products
                        responseJson.invalid_products.forEach(function (invalidProductNumber) {
                            var productRow = document.getElementById('product-row-' + invalidProductNumber);
                            if (productRow) {
                                productRow.remove();
                            }
                        });
                        closeModal()
                        showErrorMessage('Some products in your order are invalid.');
                        updateUniqueItemCount()
                    } else {
                        console.error('Error: Invalid response from the server');
                    }
                } else {
                    console.error('Error: ' + xhr.status);
                    showErrorMessage('There was a problem submitting your order. Please try again.');
                }
            };


            xhr.send(JSON.stringify(submittedData));
        }


        async function generateOrderPDF(submittedData) {

            const currentDate = new Date();
            const formattedDate = currentDate.toLocaleDateString("en-US", {
                year: "2-digit",   // Format the year as 2 digits
                month: "2-digit",  // Format the month as 2 digits
                day: "2-digit"     // Format the day as 2 digits
            });

            // Import jsPDF from the global object
            const { jsPDF } = window.jspdf;

            // Create a new PDF document
            const doc = new jsPDF();

            // Set the font and size for the title
            doc.setFont("helvetica", "bold");
            doc.setFontSize(16);
            doc.text(`Uprising Seeds Order Confirmation - ${formattedDate}`, 105, 30, { align: "center" });
            // doc.text("Order Confirmation", 105, 30, { align: "center" });

            doc.line(20, 35, 190, 35);

            // Table header for line items
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text("Quantity", 20, 50);
            doc.text("Variety", 50, 50);
            doc.text("Veg Type", 120, 50);
            doc.text("Total $", 170, 50);

            // display the varieties, veg_types, qtys, and total $ of the items ordered.
            // the submittedData that is passed in as a parameter is a dict, with item numbers (ints) as keys, and qtys as values
            // the variety/veg_type can be looked up in a global dict called product_dict, which has item_numbers (ints) as keys
            // and the values are two item lists, containing the variety and veg_type

            let currentY = 60;
            let totalPrice = 0.00;
            const maxY = 270;
            let rowCount = 0;

            doc.setFont("helvetica", "normal");
            doc.setFontSize(12);


            // Loop through the submittedData to add the line items to the PDF
            for (const [itemNumber, quantity] of Object.entries(submittedData)) {
                // Look up the variety and veg_type in the global product_dict
                const productDetails = product_dict[itemNumber];

                if (productDetails) {
                    const [variety, vegType] = productDetails;

                    // Calculate total price (assuming you have a price-per-unit lookup or calculation)
                    // Replace `getPriceForItem` with your actual logic for retrieving price

                    const totalItemPrice = pktPrice * quantity;

                    if (currentY > maxY) {
                        doc.addPage(); // Add a new page
                        currentY = 20; // Reset Y-position for the new page

                        // Add the table headers again on the new page
                        doc.setFont("helvetica", "bold");
                        // doc.setFontSize(12);

                        doc.text("Quantity", 20, currentY);
                        doc.text("Variety", 50, currentY);
                        doc.text("Veg Type", 120, currentY);
                        doc.text("Total $", 170, currentY);

                        currentY += 8; // Move down for the first row
                    }

                    // Alternate row background shading
                    if (rowCount % 2 === 0) {
                        doc.setFillColor(240, 240, 240); // Light gray
                        doc.rect(20, currentY - 4, 170, 8, "F"); // Fill the background of the row
                    }

                    const textY = currentY + 2;

                    // Add the item details to the PDF
                    doc.setFont("helvetica", "normal");
                    doc.text(quantity.toString(), 20, textY);
                    doc.text(variety, 50, textY);
                    doc.text(vegType, 120, textY);
                    doc.text(totalItemPrice.toFixed(2), 170, textY);

                    totalPrice += totalItemPrice;
                    // Move the Y-position down for the next line
                    currentY += 8;
                    rowCount++;
                }
            }

            // Add the final total price at the bottom of the last page
            if (currentY + 20 > maxY) {
                // Not enough space for the total, add a new page
                doc.addPage();
                currentY = 20; // Reset Y-position for the new page
            }

            doc.setFont("helvetica", "bold");
            doc.setFontSize(14); // Slightly larger font for the total
            currentY += 2; // Add some space before the total
            doc.text("Est. Sub-Total:", 140, currentY);
            doc.text(`$${totalPrice.toFixed(2)}`, 180, currentY);
            currentY += 8;
            doc.text("Est. Shipping", 140, currentY);
            doc.text("TBD", 180, currentY);


            // Generate a Blob URL for the PDF and open it in a new tab
            const pdfBlob = doc.output("blob");
            const pdfURL = URL.createObjectURL(pdfBlob);
            window.open(pdfURL, "_blank");
        }


        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Check if the cookie name matches
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        // Get the cookie value
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Function to sort the table rows by category, veg_type, and sub_type
        function sortTable() {
            var table = document.getElementById("product-table");
            var rows = table.getElementsByTagName("tr");


            // Convert rows to an array for sorting
            var rowsArray = Array.prototype.slice.call(rows, 1); // Exclude header row

                var categoryOrder = {
                    'vegetables': 1,
                    'herbs': 2,
                    'flowers': 3
                };

            // Sort the rows based on category, veg_type, and sub_type
            rowsArray.sort(function(row1, row2) {
                var category1 = row1.cells[2].textContent.toLowerCase();
                var category2 = row2.cells[2].textContent.toLowerCase();
                var vegType1 = row1.cells[3].textContent;
                var vegType2 = row2.cells[3].textContent;
                var subType1 = row1.cells[4].textContent;
                var subType2 = row2.cells[4].textContent;


                // Compare based on the custom order for 'category'
                if (categoryOrder[category1] !== categoryOrder[category2]) {
                    return categoryOrder[category1] - categoryOrder[category2];
                }
                // if (category1 !== category2) {
                //     return category1.localeCompare(category2);
                // }
                if (vegType1 !== vegType2) {
                    return vegType1.localeCompare(vegType2);
                }
                return subType1.localeCompare(subType2);
            });

            // Reorder the table rows based on the sorted array
            for (var i = 0; i < rowsArray.length; i++) {
                table.appendChild(rowsArray[i]);
            }

            const inputFields = document.querySelectorAll('.input-field input');
            inputFields.forEach((input, index) => {
                input.tabIndex = index + 1;
            });
        }


        // Call the sortTable function when the page loads
        window.onload = function() {
            console.log("inside window.onload");
            sortTable();
            checkPreviousItems();

            // Added this to set the dropdown to show previously ordered items by default
            var dropdown = document.getElementById("showAll-dropdown");
            var previous_items = {{ previous_items|safe }};

            console.log("previous items");
            console.log(previous_items);
            // Check if the list of previously ordered items is empty
            if (previous_items && previous_items.length > 0) {
                dropdown.value = "prevItems"; // Set to "Previously Ordered" if the list is not empty
            } else {
                dropdown.value = ""; // Set to "All Items" if the list is empty
            }

            // dropdown.value = "prevItems";
            filterTable();

        };


        function navigateToPhoto(event) {

            event.preventDefault(); // Prevent the default link behavior

            // Get the photo link URL from the data-photolink attribute
            const photoLink = event.currentTarget.getAttribute('data-photolink');

            // Open the photo in a new tab
            window.open(photoLink, '_blank');

        }

        // Add an event listener to the drop-down menu to trigger filtering when the value changes
        // document.getElementById('category-filter').addEventListener('change', filterTable);


        // Function to handle dropdown selection change for viewing new/previously ordered items
        function handleDropdownChange() {
            filterTable();
        }


        // Function to filter the table rows based on the selected category
        function filterTable() {
            console.log('inside filterTable function');
            const categoryFilter = document.getElementById('category-filter');
            const selectedCategory = categoryFilter.value.toLowerCase();

            var showAllDropdown = document.getElementById('showAll-dropdown');
            var selectedOption = showAllDropdown.options[showAllDropdown.selectedIndex].value;

            const table = document.getElementById('product-table');
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) { // Start from index 1 to skip the header row
                const row = rows[i];
                const categoryCell = row.cells[2].textContent.toLowerCase();

                if (selectedCategory === '' || categoryCell === selectedCategory || selectedCategory === 'all') {
                    if (selectedOption === "newItems") {
                        if (row.classList.contains("ordered-item")) {
                            row.style.display = 'none';
                        } else {
                            row.style.display = 'table-row';
                        }
                    } else if (selectedOption === "prevItems") {
                        if (row.classList.contains("ordered-item")) {
                            row.style.display = 'table-row';
                        } else {
                            row.style.display = 'none';
                        }
                    } else {
                        row.style.display = 'table-row';
                    }
                    // row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            }
        }
        // Add an event listener to the drop-down menu to trigger filtering when the value changes
        document.getElementById('category-filter').addEventListener('change', filterTable);

        // Add event listener for dropdown change
        document.getElementById("showAll-dropdown").addEventListener("change", handleDropdownChange);

        // Function to round a number to the nearest multiple of 5
        function roundToNearestMultipleOfFive(value) {
            return Math.round(value / 5) * 5;
        }

        // Function to handle input in the input field and round the value when focus is lost (blur event)
        function handleInput(event) {
            //console.log('inside handleInput function');
            const input = event.target;
            // Check if the Enter key is pressed or if the input field loses focus
            if (event.type === 'keydown' && event.key === 'Enter' || event.type === 'blur') {
                const originalValue = parseInt(input.value, 10);

                // Check if the input is a valid number
                if (!isNaN(originalValue)) {
                    // Round the value to the nearest multiple of 5
                    const roundedValue = roundToNearestMultipleOfFive(originalValue);

                    // Update the input field value with the rounded value
                    input.value = roundedValue;
                }
            }
        }


        // Function to clear the order form
        function clearOrder() {
            orderData = {};
            //console.log('inside clearOrder function');
            const inputFields = document.querySelectorAll('.input-field input');
            inputFields.forEach((input) => {
                input.value = 0;
            });
            //update unique item count
            updateUniqueItemCount()

            // call closeModal function
            closeModal();
        }

        document.addEventListener('DOMContentLoaded', function() {
            // console.log('DOM loaded');
            var logoutButton = document.getElementById('logout-button');
            var logoutUrl = '{% url "logout" %}';
            //console.log(logoutUrl);
            logoutButton.setAttribute('data-logout-url', logoutUrl);
            logoutButton.addEventListener('click', function() {
                // console.log('logout clicked');
                showLogoutVerification();
            });

        });

        function logout() {
            //console.log('inside logout function');
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '{% url "logout" %}', true); // Update the URL as needed
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));

            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Successfully logged out
                    window.location.href = '{% url "login" %}'; // Redirect to the login page
                } else {
                    console.error('Error: ' + xhr.status);
                    // Handle error
                }
            };

            xhr.send();
        }

        // Show an error message.... when product no longer available?
        function showErrorMessage(message) {
            const errorMessage = document.querySelector('.error-message');
            const errorText = document.getElementById('error-text');
            const closeError = document.getElementById('close-error');

            // Set the error message text
            errorText.textContent = message;

            // Display the error message
            errorMessage.style.display = 'block';


            // Add an event listener to close the error message
            closeError.addEventListener('click', function (event) {
                event.preventDefault(); // Prevent the default button behavior
                errorMessage.style.display = 'none'; // Close the error message
            });

        }


        // Event listeners to the input fields for manual input, Enter key press, and focus loss (blur)
        const inputFields = document.querySelectorAll('.input-field input');
        inputFields.forEach((input) => {
            // input.addEventListener('input', handleInput); // Add the input event listener for manual input
            input.addEventListener('input', function (event) {
                handleInput(event); // Add the input event listener for manual input
                updateUniqueItemCount(input); // Update unique item count when quantity changes
            });

            input.addEventListener('keydown', handleInput); // Add the keydown event listener to handle Enter key press
            input.addEventListener('blur', handleInput); // Add the blur event listener to handle focus loss
        });


    </script>

</body>
</html>

